sequenceDiagram
    participant User as Main Script
    participant RayRuntime as Ray Runtime
    participant Pipe as RayDataPipeline
    participant MapOp as MapRowsOp
    participant LimitOp as LimitOp
    participant InferOp as ActorPoolInferenceOp
    participant RayData as Ray Data Engine
    participant ActorPool as ActorPoolStrategy
    participant Predictor as SentimentPredictor

    User->>RayRuntime: configure_cuda
    User->>RayRuntime: init_ray
    User->>RayData: read_csv
    RayData-->>User: ds

    User->>Pipe: new RayDataPipeline
    User->>Pipe: add MapRowsOp
    User->>Pipe: add LimitOp
    User->>Pipe: add ActorPoolInferenceOp

    User->>Pipe: run(ds)
    
    Pipe->>MapOp: __call__(ds)
    MapOp->>RayData: ds.map
    RayData-->>MapOp: new_ds
    MapOp-->>Pipe: new_ds

    Pipe->>LimitOp: __call__(ds)
    LimitOp->>RayData: ds.limit
    RayData-->>LimitOp: new_ds
    LimitOp-->>Pipe: new_ds

    Pipe->>InferOp: __call__(ds)
    InferOp->>RayData: ds.map_batches
    RayData->>ActorPool: Schedule tasks
    
    loop For each batch
        ActorPool->>Predictor: __call__(batch)
        Predictor->>Predictor: vLLM.generate
        Predictor-->>ActorPool: batch with predictions
    end
    
    RayData-->>InferOp: result_ds
    InferOp-->>Pipe: result_ds

    Pipe-->>User: final_ds

    User->>RayData: final_ds.take_all()
    RayData-->>User: results

    User->>RayRuntime: shutdown_ray